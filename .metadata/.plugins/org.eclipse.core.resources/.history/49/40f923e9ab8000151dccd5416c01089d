import java.util.Scanner;
import java.io.BufferedReader;
import java.io.IOException;
import java.nio.charset.Charset;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;

public class App{
	private static Scanner in = new Scanner(System.in);
	
	public static void main(String args[]){
		System.out.println("Digite o nome do arquivo:");
		String arq = in.nextLine();
		System.out.println("Digite o nome do condominio:");
		Condominio cond = new Condominio(in.nextLine());
		
		leCotas(cond,arq);
		
		System.out.println("IMPRESSAO ::\n " + cond);
	}
	
	public static void leCotas(Condominio cond, String nomeArquivo){
		Path path = Paths.get(nomeArquivo);
		try (BufferedReader rd = Files.newBufferedReader(path,
				Charset.defaultCharset())) {
			
			String line = "";
			String nome = "";
			Bloco bloco = null;
			Apartamento apartamento = null;
			Cota cota = null;
			
			while ((line = rd.readLine()) != null) {
				if(line.contains("BLOCO")){
					bloco = new Bloco(line.charAt(6)); //pega num do bloco
					rd.readLine(); //pula uma linha
					nome = rd.readLine(); //pega nome da pessoa
					String apStr = rd.readLine(); //pega numbloco/ap
					String[] aux = apStr.split("/"); //separa
					
					int numAp = Integer.parseInt(aux[1]); //numap
					apartamento = new Apartamento(numAp); //cria ap
					
					//box
					String numBoxStr = rd.readLine();
					String[] aux2 = numBoxStr.split(" ");
					int numBox = Integer.parseInt(aux2[1]);
					apartamento.setBox(numBox);
					
					bloco.addApartamento(apartamento); //adiciona
					rd.readLine(); //pula uma linha
				}
				else if(line == " " || line == "\t" || line == "\n"){ //linha vazia
					apartamento.addCota(cota);
				}
				else if(line != null && line.charAt(0) == '0'){ //esta em uma linha da tabela
					System.out.println("LINHA: " + line);
					String[] aux3 = line.split("\t");
					
					Data dataVencimento = new Data(aux3[0]);
					Data dataPagamento = new Data(aux3[1]);
					String obs = aux3[3];
					
					String[] valorStr = aux3[2].split(",");
					double valor = Double.parseDouble(valorStr[0]) + Math.pow(10, -(valorStr[1].length()))*
									Double.parseDouble(valorStr[1]);
					
					Cota c = new Cota(nome, valor, dataPagamento, dataVencimento,obs);
					System.out.println("COTA" + c);
					apartamento.addCota(c);
				}
				else if(line.contains("NOME:")){ //está em um nome
					bloco.addApartamento(apartamento); //adiciona ap
					
					nome = rd.readLine(); //pega nome da pessoa
					String apStr = rd.readLine(); //pega numbloco/ap
					String[] aux = apStr.split("/"); //separa
					
					int numAp = Integer.parseInt(aux[1]); //numap
					apartamento = new Apartamento(numAp); //cria ap
					
					//box
					String numBoxStr = rd.readLine();
					String[] aux2 = numBoxStr.split(" ");
					int numBox = Integer.parseInt(aux2[1]);
					apartamento.setBox(numBox);
					
					bloco.addApartamento(numAp); //adiciona
					rd.readLine(); //pula uma linha
				}
			}
			cond.addBloco(bloco);
		} catch (IOException x) {
			System.err.format("Erro de E/S: %s%n", x);
		}
	}
}
